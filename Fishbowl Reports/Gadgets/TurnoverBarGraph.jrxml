<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="TurnoverBarGraph" pageWidth="216" pageHeight="216" whenNoDataType="AllSectionsNoDetail" columnWidth="216" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="423e42aa-5a6a-4a5c-9e87-1954284aa81b">
	<property name="ireport.scriptlethandling" value="0"/>
	<property name="ireport.encoding" value="UTF-8"/>
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<import value="net.sf.jasperreports.engine.*"/>
	<import value="java.util.*"/>
	<import value="net.sf.jasperreports.engine.data.*"/>
	<style name="9" fontName="Open Sans" fontSize="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10" isDefault="true" fontName="Open Sans" fontSize="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="14" fontName="Open Sans" fontSize="14" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10b" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12b" fontName="Open Sans" fontSize="12" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="14b" fontName="Open Sans" fontSize="14" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="16b" fontName="Open Sans" fontSize="16" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="18b" fontName="Open Sans" fontSize="18" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="24b" fontName="Open Sans" fontSize="24" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10i" fontName="Open Sans" fontSize="10" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="12i" fontName="Open Sans" fontSize="12" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="10bu" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="true" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header1" fontName="Open Sans" fontSize="24" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header2" fontName="Open Sans" fontSize="18" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="header3" fontName="Open Sans" fontSize="16" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="addressHeader" fontName="Open Sans" fontSize="14" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="date" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="type" fontName="Open Sans" fontSize="12" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="address" fontName="Open Sans" fontSize="10" isBold="false" isItalic="true" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="column_head" fontName="Open Sans" fontSize="10" isBold="true" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="body" isDefault="true" fontName="Open Sans" fontSize="10" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<style name="note" isDefault="true" fontName="Open Sans" fontSize="9" isBold="false" isItalic="false" isUnderline="false" isStrikeThrough="false" pdfEncoding="Cp1252" isPdfEmbedded="false"/>
	<parameter name="path" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["C:/Program Files/Fishbowl/Server/reports/WorkOrder/"]]></defaultValueExpression>
	</parameter>
	<parameter name="module" class="java.lang.Object" isForPrompting="false">
		<defaultValueExpression><![CDATA[null]]></defaultValueExpression>
	</parameter>
	<parameter name="locationGroupID" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["-1"]]></defaultValueExpression>
	</parameter>
	<parameter name="partNum" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["%"]]></defaultValueExpression>
	</parameter>
	<parameter name="dateRange1" class="java.util.Date" isForPrompting="false">
		<parameterDescription><![CDATA[This Month]]></parameterDescription>
		<defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="dateRange2" class="java.util.Date" isForPrompting="false">
		<defaultValueExpression><![CDATA[new Date()]]></defaultValueExpression>
	</parameter>
	<parameter name="PartsToShow" class="java.lang.Integer" isForPrompting="false">
		<defaultValueExpression><![CDATA[new Integer(10)]]></defaultValueExpression>
	</parameter>
	<parameter name="LoadReport" class="java.lang.String" isForPrompting="false">
		<defaultValueExpression><![CDATA["\\Inventory\\TurnoverReport.jasper"]]></defaultValueExpression>
	</parameter>
	<queryString>
		<![CDATA[SELECT PART.NUM AS PARTNUM,PART.DESCRIPTION AS PARTDESCRIPTION,
    COALESCE(SOLD.QTYSOLD, 0)  AS QTYSOLD,
    COALESCE(ONHAND.AVGQOH, 0) AS AVGQOH,
    (CASE COALESCE(SOLD.QTYSOLD, 0) WHEN 0 THEN 0 ELSE (CASE COALESCE(ONHAND.AVGQOH, 0) WHEN 0 THEN 0 ELSE COALESCE(SOLD.QTYSOLD / ONHAND.AVGQOH, 0) END) END) AS TURNOVERRATE,
    COALESCE(LOCATIONGROUP.NAME, 'No Inventory') AS LOCATIONGROUPNAME,
    COMPANY.NAME AS COMPANY

FROM part
    LEFT JOIN (SELECT AVG(inventorylog.qtyonhand) AS avgQOH, part.id AS PartID, locationgroup.id as LGID
                 FROM InventoryLog
                     LEFT JOIN part ON Part.ID = InventoryLog.partID
                     LEFT JOIN LocationGroup ON LocationGroup.ID = InventoryLog.locationGroupID
                WHERE inventorylog.typeID IN (1,10,15,20,30,40,50,60,64,67,68,72)
                  AND part.id > 0
                  AND inventorylog.eventdate BETWEEN $P{dateRange1} AND DATE_SUB($P{dateRange2}, INTERVAL 1 SECOND)
                GROUP BY part.id, locationgroup.id) onHand ON part.id = onhand.partid
    LEFT JOIN (SELECT product.partid AS PartID, SUM(soitem.qtyfulfilled) AS QtySold, so.locationgroupid AS LGID
                 FROM soitem
                     LEFT JOIN product ON soitem.productid = product.id
                     LEFT JOIN so ON so.id = soitem.soid
                WHERE soitem.typeid = 10
                  AND soitem.datelastfulfillment BETWEEN $P{dateRange1} AND DATE_SUB($P{dateRange2}, INTERVAL 1 SECOND)
                GROUP BY product.partid, so.locationgroupid) sold ON (part.id = sold.partid AND sold.lgid = onhand.lgid)
    LEFT JOIN locationgroup ON onhand.lgid = locationgroup.id
    JOIN company ON company.id = 1

WHERE part.id > 0
    AND part.typeid = 10
    AND locationgroup.id IN ($P!{locationGroupID})
    AND part.num LIKE $P{partNum}

ORDER BY turnoverRate desc

LIMIT $P{PartsToShow}]]>
	</queryString>
	<field name="PARTNUM" class="java.lang.String"/>
	<field name="PARTDESCRIPTION" class="java.lang.String"/>
	<field name="QTYSOLD" class="java.lang.Double"/>
	<field name="AVGQOH" class="java.lang.Double"/>
	<field name="TURNOVERRATE" class="java.lang.Double"/>
	<field name="LOCATIONGROUPNAME" class="java.lang.String"/>
	<field name="COMPANY" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band splitType="Prevent"/>
	</title>
	<pageHeader>
		<band splitType="Prevent"/>
	</pageHeader>
	<columnHeader>
		<band splitType="Prevent"/>
	</columnHeader>
	<detail>
		<band splitType="Prevent"/>
	</detail>
	<columnFooter>
		<band splitType="Prevent"/>
	</columnFooter>
	<pageFooter>
		<band splitType="Prevent"/>
	</pageFooter>
	<summary>
		<band height="214" splitType="Prevent">
			<bar3DChart>
				<chart>
					<reportElement key="element-24" style="note" x="0" y="0" width="216" height="214" uuid="803f9b11-391d-452b-b9c9-dd49558c6285"/>
					<chartTitle/>
					<chartSubtitle/>
					<chartLegend textColor="#000000" backgroundColor="#FFFFFF"/>
				</chart>
				<categoryDataset>
					<categorySeries>
						<seriesExpression><![CDATA[$F{PARTNUM}]]></seriesExpression>
						<categoryExpression><![CDATA[$F{PARTNUM}]]></categoryExpression>
						<valueExpression><![CDATA[$F{TURNOVERRATE}]]></valueExpression>
						<labelExpression><![CDATA[$F{PARTNUM}]]></labelExpression>
					</categorySeries>
				</categoryDataset>
				<bar3DPlot>
					<plot labelRotation="90.0"/>
					<itemLabel color="#000000" backgroundColor="#FFFFFF"/>
					<categoryAxisFormat labelRotation="90.0">
						<axisFormat/>
					</categoryAxisFormat>
					<valueAxisFormat>
						<axisFormat/>
					</valueAxisFormat>
				</bar3DPlot>
			</bar3DChart>
		</band>
	</summary>
</jasperReport>
